<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Blueprint & Cost Estimator (Indian Rupees)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        /* ====== HEADER ====== */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* ====== TABS ====== */
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #ecf0f1;
        }

        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ====== CONTENT LAYOUT ====== */
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .section h3 {
            color: #34495e;
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        /* ====== FORM INPUTS ====== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* ====== BLUEPRINT CANVAS ====== */
        .blueprint-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }

        .blueprint-container h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        canvas {
            border: 1px solid #ccc;
            background: white;
            border-radius: 5px;
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        /* ====== BUTTONS ====== */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .button-group .btn {
            flex: 1;
            min-width: 150px;
        }

        /* ====== MATERIAL TABLE ====== */
        .material-input {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }

        .material-input select,
        .material-input input {
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 0.95em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table thead {
            background: #34495e;
            color: white;
        }

        table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }

        table tbody tr:hover {
            background: #ecf0f1;
        }

        /* ====== DASHBOARD ====== */
        .dashboard-full {
            grid-column: 1 / -1;
            background: white;
            padding: 30px;
            border-radius: 10px;
            border-left: 5px solid #27ae60;
        }

        .dashboard-full h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .card-value {
            font-size: 2em;
            font-weight: 700;
        }

        .card.materials {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .card.labor {
            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
        }

        .card.contingency {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .card.total {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            grid-column: 1 / -1;
        }

        .summary-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #3498db;
        }

        .summary-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .summary-table tr {
            border-bottom: 1px solid #ecf0f1;
        }

        .summary-table td {
            padding: 12px;
        }

        .summary-table td:first-child {
            font-weight: 600;
            color: #2c3e50;
        }

        .summary-table td:last-child {
            text-align: right;
            color: #27ae60;
            font-weight: 600;
        }

        .summary-table tr:last-child {
            border-top: 2px solid #3498db;
            border-bottom: 2px solid #3498db;
            font-size: 1.1em;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 20px;
        }

        /* ====== BLUEPRINT TAB SPECIFIC ====== */
        .blueprint-tab-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }

        .blueprint-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .blueprint-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        /* ====== RESPONSIVE ====== */
        @media (max-width: 1024px) {
            .content,
            .blueprint-tab-content {
                grid-template-columns: 1fr;
            }

            .card.total {
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-button {
                flex: 1 1 50%;
            }

            .material-input {
                grid-template-columns: 1fr;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
        }

        .currency {
            color: #27ae60;
            font-weight: bold;
        }

        .india-flag {
            display: inline-block;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- HEADER -->
        <div class="header">
            <h1>üè¢ Building Blueprint & Cost Estimator</h1>
            <p>Design Blueprint ‚Üí Extract Dimensions ‚Üí Material Breakdown ‚Üí Cost Analysis (Indian Rupees)</p>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('input')">üìê Input & Calculation</button>
            <button class="tab-button" onclick="switchTab('blueprint')">üé® Blueprint Visualization</button>
            <button class="tab-button" onclick="switchTab('report')">üìä Cost Report</button>
        </div>

        <!-- TAB 1: INPUT & CALCULATION -->
        <div id="input" class="tab-content active">
            <div class="content">
                <!-- LEFT SIDE: INPUT SECTION -->
                <div class="section">
                    <h2>üìê Step 1: Extract Dimensions</h2>

                    <h3>Building Dimensions (1D Blueprint)</h3>
                    <div class="form-group">
                        <label for="length">Length (meters):</label>
                        <input type="number" id="length" min="1" step="0.1" value="50" required>
                    </div>

                    <div class="input-row">
                        <div class="form-group">
                            <label for="width">Width (meters):</label>
                            <input type="number" id="width" min="1" step="0.1" value="30" required>
                        </div>
                        <div class="form-group">
                            <label for="height">Height (meters):</label>
                            <input type="number" id="height" min="1" step="0.1" value="25" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="floors">Number of Floors:</label>
                        <input type="number" id="floors" min="1" max="50" value="5" required>
                    </div>

                    <h3>Building Parameters</h3>
                    <div class="form-group">
                        <label for="buildingType">Building Type:</label>
                        <select id="buildingType">
                            <option value="residential">Residential (1.0x multiplier)</option>
                            <option value="commercial" selected>Commercial (1.3x multiplier)</option>
                            <option value="industrial">Industrial (1.5x multiplier)</option>
                        </select>
                    </div>

                    <div class="input-row">
                        <div class="form-group">
                            <label for="laborPercent">Labor Cost %:</label>
                            <input type="number" id="laborPercent" min="0" value="25" required>
                        </div>
                        <div class="form-group">
                            <label for="contingency">Contingency %:</label>
                            <input type="number" id="contingency" min="0" value="10" required>
                        </div>
                    </div>

                    <h3>Material & Labor Breakdown</h3>
                    <div class="material-input">
                        <select id="materialSelect">
                            <option value="Concrete">Concrete (‚Çπ12,000/m¬≥)</option>
                            <option value="Steel">Steel (‚Çπ68,000/ton)</option>
                            <option value="Brick">Brick (‚Çπ28,000/1000)</option>
                            <option value="Cement">Cement (‚Çπ680/bag)</option>
                            <option value="Sand">Sand (‚Çπ3,600/m¬≥)</option>
                            <option value="Gravel">Gravel (‚Çπ2,800/m¬≥)</option>
                            <option value="Wood">Wood (‚Çπ40,000/m¬≥)</option>
                            <option value="Glass">Glass (‚Çπ16,000/m¬≤)</option>
                            <option value="Paint">Paint (‚Çπ960/liter)</option>
                            <option value="Electrical Wiring">Electrical Wiring (‚Çπ280/meter)</option>
                            <option value="Pipes">Pipes (‚Çπ400/meter)</option>
                            <option value="Tiles">Tiles (‚Çπ2,000/m¬≤)</option>
                        </select>
                        <input type="number" id="materialQty" placeholder="Quantity" min="0" step="0.1">
                        <button type="button" class="btn btn-success" onclick="addMaterial()">Add</button>
                    </div>

                    <table id="materialsTable">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Qty</th>
                                <th>Unit Cost</th>
                                <th>Total</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="materialsBody">
                            <tr class="empty-state">
                                <td colspan="5">No materials added</td>
                            </tr>
                        </tbody>
                    </table>

                    <button type="button" class="btn btn-primary" onclick="updateDashboard()" style="margin-top: 20px;">Recalculate</button>
                </div>

                <!-- RIGHT SIDE: SUMMARY -->
                <div class="section">
                    <h2>üìä Blueprint Summary</h2>

                    <h3>Extracted Dimensions</h3>
                    <table class="summary-table">
                        <tr>
                            <td>Length:</td>
                            <td id="summaryLength">50 m</td>
                        </tr>
                        <tr>
                            <td>Width:</td>
                            <td id="summaryWidth">30 m</td>
                        </tr>
                        <tr>
                            <td>Height:</td>
                            <td id="summaryHeight">25 m</td>
                        </tr>
                        <tr>
                            <td>Floors:</td>
                            <td id="summaryFloors">5</td>
                        </tr>
                        <tr>
                            <td>Building Type:</td>
                            <td id="summaryType">Commercial</td>
                        </tr>
                    </table>

                    <h3>Building Specifications</h3>
                    <table class="summary-table">
                        <tr>
                            <td>Floor Area:</td>
                            <td id="summaryArea">7,500 m¬≤</td>
                        </tr>
                        <tr>
                            <td>Total Volume:</td>
                            <td id="summaryVolume">37,500 m¬≥</td>
                        </tr>
                        <tr>
                            <td>Area per Floor:</td>
                            <td id="summaryAreaPerFloor">1,500 m¬≤</td>
                        </tr>
                    </table>

                    <h3>Cost Estimation Factors</h3>
                    <table class="summary-table">
                        <tr>
                            <td>Type Multiplier:</td>
                            <td id="summaryMultiplier">1.3x</td>
                        </tr>
                        <tr>
                            <td>Labor %:</td>
                            <td id="summaryLaborPercent">25%</td>
                        </tr>
                        <tr>
                            <td>Contingency %:</td>
                            <td id="summaryContingency">10%</td>
                        </tr>
                    </table>
                </div>

                <!-- FULL WIDTH: DASHBOARD -->
                <div class="dashboard-full">
                    <h2>üí∞ Cost Analysis Dashboard (Indian Rupees)</h2>

                    <div class="cards-grid">
                        <div class="card materials">
                            <h3>Materials Cost</h3>
                            <div class="card-value" id="dashMaterials">‚Çπ0</div>
                        </div>

                        <div class="card labor">
                            <h3>Labor Cost</h3>
                            <div class="card-value" id="dashLabor">‚Çπ0</div>
                        </div>

                        <div class="card contingency">
                            <h3>Contingency</h3>
                            <div class="card-value" id="dashContingency">‚Çπ0</div>
                        </div>

                        <div class="card total">
                            <h3>TOTAL PROJECT COST</h3>
                            <div class="card-value" id="dashTotal">‚Çπ0</div>
                        </div>
                    </div>

                    <div class="summary-section">
                        <h3>Detailed Cost Breakdown</h3>
                        <table class="summary-table">
                            <tr>
                                <td>Materials Subtotal:</td>
                                <td id="breakdownMaterials">‚Çπ0</td>
                            </tr>
                            <tr>
                                <td>Labor Cost (25%):</td>
                                <td id="breakdownLabor">‚Çπ0</td>
                            </tr>
                            <tr>
                                <td>Subtotal:</td>
                                <td id="breakdownSubtotal">‚Çπ0</td>
                            </tr>
                            <tr>
                                <td>Contingency (10%):</td>
                                <td id="breakdownContingency">‚Çπ0</td>
                            </tr>
                            <tr>
                                <td>Subtotal with Contingency:</td>
                                <td id="breakdownSubtotalContingency">‚Çπ0</td>
                            </tr>
                            <tr>
                                <td>Type Multiplier Applied:</td>
                                <td id="breakdownMultiplied">‚Çπ0</td>
                            </tr>
                            <tr>
                                <td>TOTAL PROJECT COST:</td>
                                <td id="breakdownTotal">‚Çπ0</td>
                            </tr>
                        </table>
                    </div>

                    <div class="summary-section">
                        <h3>Materials Used Summary</h3>
                        <div id="materialsSummary" class="empty-state">No materials added</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: BLUEPRINT VISUALIZATION -->
        <div id="blueprint" class="tab-content">
            <div class="blueprint-tab-content">
                <div class="blueprint-section">
                    <h2>üé® Building Blueprint (2D View)</h2>
                    <canvas id="blueprintCanvas" width="500" height="500"></canvas>
                    <button class="btn btn-primary" onclick="drawBlueprint()" style="margin-top: 15px;">Render Blueprint</button>
                </div>

                <div class="blueprint-section">
                    <h2>üèóÔ∏è 3D Perspective View</h2>
                    <canvas id="perspectiveCanvas" width="500" height="500"></canvas>
                    <button class="btn btn-primary" onclick="drawPerspective()" style="margin-top: 15px;">Render 3D View</button>
                </div>

                <div class="blueprint-section" style="grid-column: 1 / -1;">
                    <h2>üìã Blueprint Details</h2>
                    <div id="blueprintDetails" style="background: #f8f9fa; padding: 20px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; word-break: break-word;"></div>
                </div>
            </div>
        </div>

        <!-- TAB 3: COST REPORT -->
        <div id="report" class="tab-content">
            <div style="padding: 40px;">
                <h2 style="color: #2c3e50; text-align: center; margin-bottom: 30px;">üìÑ Comprehensive Cost Report (‚Çπ Indian Rupees)</h2>

                <div class="summary-section">
                    <h3>Project Overview</h3>
                    <table class="summary-table">
                        <tr>
                            <td>Project Name:</td>
                            <td id="reportProjectName">Building Estimation</td>
                        </tr>
                        <tr>
                            <td>Building Type:</td>
                            <td id="reportBuildingType">Commercial</td>
                        </tr>
                        <tr>
                            <td>Dimensions:</td>
                            <td id="reportDimensions">50m √ó 30m √ó 25m</td>
                        </tr>
                        <tr>
                            <td>Number of Floors:</td>
                            <td id="reportFloors">5</td>
                        </tr>
                        <tr>
                            <td>Total Floor Area:</td>
                            <td id="reportArea">7,500 m¬≤</td>
                        </tr>
                    </table>
                </div>

                <div class="summary-section">
                    <h3>Materials Used</h3>
                    <div id="reportMaterials" class="empty-state">No materials added</div>
                </div>

                <div class="summary-section">
                    <h3>Financial Summary</h3>
                    <table class="summary-table">
                        <tr>
                            <td>Materials Cost:</td>
                            <td id="reportMaterialsCost">‚Çπ0</td>
                        </tr>
                        <tr>
                            <td>Labor Cost (25%):</td>
                            <td id="reportLaborCost">‚Çπ0</td>
                        </tr>
                        <tr>
                            <td>Subtotal:</td>
                            <td id="reportSubtotal">‚Çπ0</td>
                        </tr>
                        <tr>
                            <td>Contingency (10%):</td>
                            <td id="reportContingencyCost">‚Çπ0</td>
                        </tr>
                        <tr>
                            <td>Subtotal with Contingency:</td>
                            <td id="reportSubtotalContingency">‚Çπ0</td>
                        </tr>
                        <tr>
                            <td>Building Type Multiplier (1.3x):</td>
                            <td id="reportMultiplierInfo">+30%</td>
                        </tr>
                        <tr>
                            <td style="border-top: 2px solid #3498db; font-size: 1.2em;">TOTAL PROJECT COST:</td>
                            <td style="border-top: 2px solid #3498db; font-size: 1.2em; color: #e74c3c;" id="reportTotalCost">‚Çπ0</td>
                        </tr>
                    </table>
                </div>

                <div class="summary-section">
                    <h3>Cost Breakdown by Category</h3>
                    <canvas id="reportChart" width="600" height="300"></canvas>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="exportToPDF()">üì• Export as PDF</button>
                        <button class="btn btn-secondary" onclick="printReport()">üñ®Ô∏è Print Report</button>
                        <button class="btn btn-success" onclick="downloadJSON()">üìã Download JSON</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div style="background: #2c3e50; color: white; text-align: center; padding: 20px;">
            <p>&copy; 2026 Building Blueprint & Cost Estimator (India) | Professional Construction Estimation Tool</p>
            <p style="font-size: 0.9em; margin-top: 10px;">All prices in Indian Rupees (‚Çπ) | GST not included</p>
        </div>
    </div>

    <script>
        // ====== DATA & CONFIG (IN INDIAN RUPEES) ======
        const MATERIAL_PRICES = {
            'Concrete': 12000,          // ‚Çπ per m¬≥
            'Steel': 68000,             // ‚Çπ per ton
            'Brick': 28000,             // ‚Çπ per 1000 units
            'Cement': 680,              // ‚Çπ per bag
            'Sand': 3600,               // ‚Çπ per m¬≥
            'Gravel': 2800,             // ‚Çπ per m¬≥
            'Wood': 40000,              // ‚Çπ per m¬≥
            'Glass': 16000,             // ‚Çπ per m¬≤
            'Paint': 960,               // ‚Çπ per liter
            'Electrical Wiring': 280,   // ‚Çπ per meter
            'Pipes': 400,               // ‚Çπ per meter
            'Tiles': 2000               // ‚Çπ per m¬≤
        };

        const TYPE_MULTIPLIERS = {
            'residential': 1.0,
            'commercial': 1.3,
            'industrial': 1.5
        };

        let materials = [];
        let projectData = {};

        // ====== TAB SWITCHING ======
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'blueprint') {
                setTimeout(() => { drawBlueprint(); drawPerspective(); }, 100);
            } else if (tabName === 'report') {
                setTimeout(() => drawReportChart(), 100);
            }
        }

        // ====== FORMAT RUPEES ======
        function formatRupees(amount) {
            return '‚Çπ' + amount.toLocaleString('en-IN', { maximumFractionDigits: 0 });
        }

        function formatRupeesDecimal(amount) {
            return '‚Çπ' + amount.toLocaleString('en-IN', { maximumFractionDigits: 2 });
        }

        // ====== GET DIMENSIONS & PARAMETERS ======
        function getDimensions() {
            return {
                length: parseFloat(document.getElementById('length').value) || 0,
                width: parseFloat(document.getElementById('width').value) || 0,
                height: parseFloat(document.getElementById('height').value) || 0,
                floors: parseInt(document.getElementById('floors').value) || 1
            };
        }

        function getParameters() {
            return {
                buildingType: document.getElementById('buildingType').value,
                laborPercent: parseFloat(document.getElementById('laborPercent').value) / 100 || 0.25,
                contingency: parseFloat(document.getElementById('contingency').value) / 100 || 0.10
            };
        }

        // ====== ADD MATERIAL ======
        function addMaterial() {
            const select = document.getElementById('materialSelect');
            const qtyInput = document.getElementById('materialQty');
            const material = select.value;
            const qty = parseFloat(qtyInput.value);

            if (!material || qty <= 0) {
                alert('Please enter valid material and quantity');
                return;
            }

            const unitPrice = MATERIAL_PRICES[material];
            const totalCost = unitPrice * qty;

            materials.push({ material, qty, unitPrice, totalCost });
            qtyInput.value = '';
            updateMaterialsTable();
            updateDashboard();
        }

        // ====== REMOVE MATERIAL ======
        function removeMaterial(index) {
            materials.splice(index, 1);
            updateMaterialsTable();
            updateDashboard();
        }

        // ====== UPDATE MATERIALS TABLE ======
        function updateMaterialsTable() {
            const tbody = document.getElementById('materialsBody');

            if (materials.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="5">No materials added</td></tr>';
                return;
            }

            tbody.innerHTML = materials.map((m, i) => `
                <tr>
                    <td>${m.material}</td>
                    <td>${m.qty}</td>
                    <td>${formatRupees(m.unitPrice)}</td>
                    <td>${formatRupees(m.totalCost)}</td>
                    <td><button class="btn btn-danger" onclick="removeMaterial(${i})">Remove</button></td>
                </tr>
            `).join('');
        }

        // ====== UPDATE DASHBOARD ======
        function updateDashboard() {
            const dims = getDimensions();
            const params = getParameters();

            // Update Summary
            document.getElementById('summaryLength').textContent = dims.length + ' m';
            document.getElementById('summaryWidth').textContent = dims.width + ' m';
            document.getElementById('summaryHeight').textContent = dims.height + ' m';
            document.getElementById('summaryFloors').textContent = dims.floors;
            document.getElementById('summaryType').textContent = params.buildingType.charAt(0).toUpperCase() + params.buildingType.slice(1);

            const area = dims.length * dims.width * dims.floors;
            const areaPerFloor = dims.length * dims.width;
            const volume = dims.length * dims.width * dims.height;

            document.getElementById('summaryArea').textContent = area.toLocaleString('en-IN') + ' m¬≤';
            document.getElementById('summaryVolume').textContent = volume.toLocaleString('en-IN') + ' m¬≥';
            document.getElementById('summaryAreaPerFloor').textContent = areaPerFloor.toLocaleString('en-IN') + ' m¬≤';

            const multiplier = TYPE_MULTIPLIERS[params.buildingType];
            document.getElementById('summaryMultiplier').textContent = multiplier + 'x';
            document.getElementById('summaryLaborPercent').textContent = (params.laborPercent * 100) + '%';
            document.getElementById('summaryContingency').textContent = (params.contingency * 100) + '%';

            // Calculate Costs
            const materialsCost = materials.reduce((sum, m) => sum + m.totalCost, 0);
            const laborCost = materialsCost * params.laborPercent;
            const subtotal = materialsCost + laborCost;
            const contingencyCost = subtotal * params.contingency;
            const subtotalWithContingency = subtotal + contingencyCost;
            const totalCost = subtotalWithContingency * multiplier;

            // Update Dashboard Cards
            document.getElementById('dashMaterials').textContent = formatRupeesDecimal(materialsCost);
            document.getElementById('dashLabor').textContent = formatRupeesDecimal(laborCost);
            document.getElementById('dashContingency').textContent = formatRupeesDecimal(contingencyCost);
            document.getElementById('dashTotal').textContent = formatRupeesDecimal(totalCost);

            // Update Breakdown
            document.getElementById('breakdownMaterials').textContent = formatRupeesDecimal(materialsCost);
            document.getElementById('breakdownLabor').textContent = formatRupeesDecimal(laborCost);
            document.getElementById('breakdownSubtotal').textContent = formatRupeesDecimal(subtotal);
            document.getElementById('breakdownContingency').textContent = formatRupeesDecimal(contingencyCost);
            document.getElementById('breakdownSubtotalContingency').textContent = formatRupeesDecimal(subtotalWithContingency);
            document.getElementById('breakdownMultiplied').textContent = formatRupeesDecimal(subtotalWithContingency) + ' √ó ' + multiplier + ' = ' + formatRupeesDecimal(totalCost);
            document.getElementById('breakdownTotal').textContent = formatRupeesDecimal(totalCost);

            // Materials Summary
            if (materials.length === 0) {
                document.getElementById('materialsSummary').innerHTML = '<div class="empty-state">No materials added</div>';
            } else {
                let summaryHTML = '<table class="summary-table">';
                materials.forEach(m => {
                    summaryHTML += `<tr><td>${m.material}</td><td>${m.qty} units @ ${formatRupees(m.unitPrice)} = ${formatRupeesDecimal(m.totalCost)}</td></tr>`;
                });
                summaryHTML += '</table>';
                document.getElementById('materialsSummary').innerHTML = summaryHTML;
            }

            // Store for report
            projectData = {
                dims, params, materials, materialsCost, laborCost, subtotal,
                contingencyCost, subtotalWithContingency, totalCost, multiplier, area, volume, areaPerFloor
            };

            updateReportTab();
        }

        // ====== UPDATE REPORT TAB ======
        function updateReportTab() {
            if (!projectData.dims) return;

            document.getElementById('reportProjectName').textContent = 'Building Estimation Project';
            document.getElementById('reportBuildingType').textContent = projectData.params.buildingType.charAt(0).toUpperCase() + projectData.params.buildingType.slice(1);
            document.getElementById('reportDimensions').textContent = projectData.dims.length + 'm √ó ' + projectData.dims.width + 'm √ó ' + projectData.dims.height + 'm';
            document.getElementById('reportFloors').textContent = projectData.dims.floors;
            document.getElementById('reportArea').textContent = projectData.area.toLocaleString('en-IN') + ' m¬≤';

            if (materials.length === 0) {
                document.getElementById('reportMaterials').innerHTML = '<div class="empty-state">No materials added</div>';
            } else {
                let materialsHTML = '<table class="summary-table">';
                materials.forEach(m => {
                    materialsHTML += `<tr><td>${m.material}</td><td>${m.qty} √ó ${formatRupees(m.unitPrice)} = ${formatRupeesDecimal(m.totalCost)}</td></tr>`;
                });
                materialsHTML += '</table>';
                document.getElementById('reportMaterials').innerHTML = materialsHTML;
            }

            document.getElementById('reportMaterialsCost').textContent = formatRupeesDecimal(projectData.materialsCost);
            document.getElementById('reportLaborCost').textContent = formatRupeesDecimal(projectData.laborCost);
            document.getElementById('reportSubtotal').textContent = formatRupeesDecimal(projectData.subtotal);
            document.getElementById('reportContingencyCost').textContent = formatRupeesDecimal(projectData.contingencyCost);
            document.getElementById('reportSubtotalContingency').textContent = formatRupeesDecimal(projectData.subtotalWithContingency);
            document.getElementById('reportMultiplierInfo').textContent = (projectData.multiplier - 1) * 100 + '%';
            document.getElementById('reportTotalCost').textContent = formatRupeesDecimal(projectData.totalCost);
        }

        // ====== DRAW 2D BLUEPRINT ======
        function drawBlueprint() {
            const canvas = document.getElementById('blueprintCanvas');
            const ctx = canvas.getContext('2d');
            const dims = getDimensions();

            // Clear canvas
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Scale
            const maxDim = Math.max(dims.length, dims.width);
            const scale = (canvas.width - 80) / maxDim;
            const startX = (canvas.width - dims.length * scale) / 2;
            const startY = (canvas.height - dims.width * scale) / 2;

            // Draw building outline
            ctx.strokeStyle = '#2c3e50';
            ctx.fillStyle = 'rgba(52, 152, 219, 0.1)';
            ctx.lineWidth = 3;
            ctx.fillRect(startX, startY, dims.length * scale, dims.width * scale);
            ctx.strokeRect(startX, startY, dims.length * scale, dims.width * scale);

            // Draw floor divisions
            const floorDivisionX = (dims.length * scale) / dims.floors;
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            for (let i = 1; i < dims.floors; i++) {
                ctx.beginPath();
                ctx.moveTo(startX + i * floorDivisionX, startY);
                ctx.lineTo(startX + i * floorDivisionX, startY + dims.width * scale);
                ctx.stroke();
            }
            ctx.setLineDash([]);

            // Draw dimensions
            ctx.strokeStyle = '#e74c3c';
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 14px Arial';

            // Length label
            ctx.fillText(dims.length + 'm', startX + (dims.length * scale) / 2 - 20, startY - 10);
            ctx.beginPath();
            ctx.moveTo(startX, startY - 5);
            ctx.lineTo(startX + dims.length * scale, startY - 5);
            ctx.stroke();

            // Width label
            ctx.save();
            ctx.translate(startX - 40, startY + (dims.width * scale) / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText(dims.width + 'm', 0, 0);
            ctx.restore();

            // Draw grid
            ctx.strokeStyle = 'rgba(52, 152, 219, 0.15)';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= dims.length; i += 10) {
                const x = startX + (i / dims.length) * dims.length * scale;
                ctx.beginPath();
                ctx.moveTo(x, startY);
                ctx.lineTo(x, startY + dims.width * scale);
                ctx.stroke();
            }
            for (let i = 0; i <= dims.width; i += 10) {
                const y = startY + (i / dims.width) * dims.width * scale;
                ctx.beginPath();
                ctx.moveTo(startX, y);
                ctx.lineTo(startX + dims.length * scale, y);
                ctx.stroke();
            }

            // Draw compass
            drawCompass(ctx, startX + dims.length * scale + 50, startY + 50);

            // Update blueprint details
            const details = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë       BUILDING BLUEPRINT DETAILS      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üè¢ DIMENSIONS:
  ‚Ä¢ Length: ${dims.length} meters
  ‚Ä¢ Width: ${dims.width} meters
  ‚Ä¢ Height: ${dims.height} meters
  ‚Ä¢ Number of Floors: ${dims.floors}

üìê CALCULATED AREAS:
  ‚Ä¢ Floor Area: ${(dims.length * dims.width).toFixed(2)} m¬≤
  ‚Ä¢ Total Area: ${(dims.length * dims.width * dims.floors).toFixed(2)} m¬≤
  ‚Ä¢ Volume: ${(dims.length * dims.width * dims.height).toFixed(2)} m¬≥

üèóÔ∏è BUILDING TYPE:
  ‚Ä¢ Type: ${projectData.params.buildingType.toUpperCase()}
  ‚Ä¢ Multiplier: ${projectData.multiplier}x

üìä SCALE RATIO:
  ‚Ä¢ 1:${(1 / scale).toFixed(2)} (Canvas representation)

‚úèÔ∏è NOTE:
  This is a 2D top-view blueprint representation
  of your building design.

üíµ CURRENT ESTIMATE:
  ‚Ä¢ Total Project Cost: ${formatRupeesDecimal(projectData.totalCost)}
            `;

            document.getElementById('blueprintDetails').textContent = details;
        }

        // ====== DRAW 3D PERSPECTIVE ======
        function drawPerspective() {
            const canvas = document.getElementById('perspectiveCanvas');
            const ctx = canvas.getContext('2d');
            const dims = getDimensions();

            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const scale = 3;
            const startX = 100;
            const startY = 150;

            // Draw 3D cube representation
            const points = [
                [startX, startY],
                [startX + dims.length * scale, startY],
                [startX + dims.length * scale, startY + dims.width * scale],
                [startX, startY + dims.width * scale],
                [startX + 40, startY - 40],
                [startX + dims.length * scale + 40, startY - 40],
                [startX + dims.length * scale + 40, startY + dims.width * scale - 40],
                [startX + 40, startY + dims.width * scale - 40]
            ];

            // Front face
            ctx.strokeStyle = '#2c3e50';
            ctx.fillStyle = 'rgba(52, 152, 219, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            ctx.lineTo(points[1][0], points[1][1]);
            ctx.lineTo(points[2][0], points[2][1]);
            ctx.lineTo(points[3][0], points[3][1]);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Top face
            ctx.fillStyle = 'rgba(52, 152, 219, 0.6)';
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            ctx.lineTo(points[4][0], points[4][1]);
            ctx.lineTo(points[5][0], points[5][1]);
            ctx.lineTo(points[1][0], points[1][1]);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Right face
            ctx.fillStyle = 'rgba(52, 152, 219, 0.5)';
            ctx.beginPath();
            ctx.moveTo(points[1][0], points[1][1]);
            ctx.lineTo(points[5][0], points[5][1]);
            ctx.lineTo(points[6][0], points[6][1]);
            ctx.lineTo(points[2][0], points[2][1]);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Draw height indicator
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(points[2][0], points[2][1]);
            ctx.lineTo(points[6][0], points[6][1]);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.fillText(dims.length + 'm', startX + dims.length * scale / 2 - 20, startY + dims.width * scale + 20);
            ctx.fillText(dims.width + 'm', startX - 50, startY + dims.width * scale / 2);
            ctx.fillText(dims.height + 'm', points[2][0] + 10, points[2][1] - dims.height / 3);
            ctx.fillText('Floors: ' + dims.floors, startX + 10, startY + 20);

            // 3D details
            const perspective3D = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë    3D PERSPECTIVE VIEW (ISOMETRIC)    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üì¶ 3D DIMENSIONS:
  ‚Ä¢ Length (X-axis): ${dims.length} m
  ‚Ä¢ Width (Y-axis): ${dims.width} m
  ‚Ä¢ Height (Z-axis): ${dims.height} m
  ‚Ä¢ Floors: ${dims.floors}

üé® COLOR CODING:
  ‚Ä¢ Front Face: Light Blue (Main View)
  ‚Ä¢ Top Face: Medium Blue (Roof/Top)
  ‚Ä¢ Right Face: Dark Blue (Side View)

üìä VOLUME CALCULATION:
  ‚Ä¢ Total Volume: ${(dims.length * dims.width * dims.height).toFixed(2)} m¬≥
  ‚Ä¢ Per Floor Area: ${(dims.length * dims.width).toFixed(2)} m¬≤
  ‚Ä¢ Total Floor Area: ${(dims.length * dims.width * dims.floors).toFixed(2)} m¬≤

üè¢ FLOOR BREAKDOWN:
  ‚Ä¢ Number of Floors: ${dims.floors}
  ‚Ä¢ Area per Floor: ${(dims.length * dims.width).toFixed(2)} m¬≤
  ‚Ä¢ Average Floor Height: ${(dims.height / dims.floors).toFixed(2)} m

üíµ ESTIMATED COST IN ‚Çπ:
  ‚Ä¢ Total: ${formatRupeesDecimal(projectData.totalCost)}
            `;

            document.getElementById('blueprintDetails').textContent = perspective3D;
        }

        // ====== DRAW COMPASS ======
        function drawCompass(ctx, x, y) {
            ctx.fillStyle = '#2c3e50';
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.arc(x, y, 25, 0, 2 * Math.PI);
            ctx.stroke();

            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            ctx.fillText('N', x, y - 30);
            ctx.fillText('E', x + 30, y);
            ctx.fillText('S', x, y + 30);
            ctx.fillText('W', x - 30, y);

            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y - 25);
            ctx.lineTo(x - 5, y - 15);
            ctx.moveTo(x, y - 25);
            ctx.lineTo(x + 5, y - 15);
            ctx.stroke();
        }

        // ====== DRAW REPORT CHART ======
        function drawReportChart() {
            if (!projectData.totalCost) return;

            const canvas = document.getElementById('reportChart');
            const ctx = canvas.getContext('2d');

            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const data = [
                { label: 'Materials', value: projectData.materialsCost, color: '#27ae60' },
                { label: 'Labor', value: projectData.laborCost, color: '#f39c12' },
                { label: 'Contingency', value: projectData.contingencyCost, color: '#3498db' }
            ];

            const centerX = canvas.width / 3;
            const centerY = canvas.height / 2;
            const radius = 80;
            let currentAngle = -Math.PI / 2;

            data.forEach((item) => {
                const sliceAngle = (item.value / projectData.subtotalWithContingency) * 2 * Math.PI;

                ctx.fillStyle = item.color;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();

                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();

                currentAngle += sliceAngle;
            });

            // Legend
            const legendX = centerX + 120;
            let legendY = centerY - 60;

            data.forEach((item) => {
                ctx.fillStyle = item.color;
                ctx.fillRect(legendX, legendY, 15, 15);

                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`${item.label}: ${formatRupeesDecimal(item.value)}`, legendX + 25, legendY + 12);

                legendY += 30;
            });
        }

        // ====== EXPORT FUNCTIONS ======
        function exportToPDF() {
            alert('For PDF export, use the Print button and save as PDF');
        }

        function printReport() {
            window.print();
        }

        function downloadJSON() {
            const jsonData = {
                project: 'Building Estimation (India)',
                currency: 'Indian Rupees (‚Çπ)',
                timestamp: new Date().toISOString(),
                building: projectData.dims,
                parameters: projectData.params,
                materials: materials,
                costs: {
                    materials: projectData.materialsCost,
                    labor: projectData.laborCost,
                    contingency: projectData.contingencyCost,
                    subtotal: projectData.subtotalWithContingency,
                    total: projectData.totalCost
                }
            };

            const dataStr = JSON.stringify(jsonData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'building-estimation-india-' + new Date().getTime() + '.json';
            link.click();
        }

        // ====== EVENT LISTENERS ======
        ['length', 'width', 'height', 'floors', 'buildingType', 'laborPercent', 'contingency'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateDashboard);
        });

        // Initial update
        updateDashboard();
    </script>
</body>
</html>